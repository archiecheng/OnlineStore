<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Online Store" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.14/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Keep autofill background white for inputs */
      input:-webkit-autofill,
      input:-webkit-autofill:hover,
      input:-webkit-autofill:focus,
      textarea:-webkit-autofill,
      textarea:-webkit-autofill:hover,
      textarea:-webkit-autofill:focus,
      select:-webkit-autofill,
      select:-webkit-autofill:hover,
      select:-webkit-autofill:focus {
        -webkit-box-shadow: 0 0 0px 1000px white inset;
        box-shadow: 0 0 0px 1000px white inset;
        -webkit-text-fill-color: #1f2937;
      }
      /* Ensure caret and text color stay visible */
      input, textarea, select {
        color: #1f2937;
        caret-color: #4f46e5;
      }
    </style>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">
    <header class="sticky top-0 z-20 bg-white/90 backdrop-blur shadow-sm border-b border-gray-100">
      <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-4">
        <div class="flex items-center gap-3"></div>
        <nav class="hidden md:flex items-center gap-4 text-sm font-medium text-gray-600">
          <%= link_to "Home", root_path, class: "hover:text-indigo-600" %>
          <%= link_to "Products", products_path, class: "hover:text-indigo-600" %>
          <% if admin_user? %>
            <%= link_to "Manage Products", new_product_path, class: "hover:text-indigo-600" %>
          <% end %>
        </nav>
        <div class="flex-1"></div>
        <div class="hidden md:block w-64">
          <%= form_with url: search_products_path, method: :get, local: true do %>
            <div class="relative">
              <%= text_field_tag :query, params[:query], placeholder: "Search products", class: "w-full rounded-full border border-gray-200 bg-gray-50 pr-12 pl-4 py-2 text-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200" %>
              <span class="absolute inset-y-0 right-3 flex items-center text-gray-400 text-lg pointer-events-none">üîç</span>
            </div>
          <% end %>
        </div>
        <% if current_user && !admin_user? %>
          <% cart_count = @cart&.cart_items&.sum(:quantity).to_i %>
          <%= link_to cart_path(current_user.cart), class: "relative inline-flex items-center justify-center w-11 h-11 rounded-full border border-gray-200 bg-white hover:border-indigo-400 hover:text-indigo-600 transition" do %>
            üõí
            <% if cart_count.positive? %>
              <span class="absolute -top-1 -right-1 bg-indigo-600 text-white text-xs rounded-full px-2 py-0.5"><%= cart_count %></span>
            <% end %>
          <% end %>
        <% end %>
        <div class="dropdown dropdown-end">
          <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
            <div class="w-10 rounded-full ring ring-indigo-100 overflow-hidden">
              <%= image_tag "avatar.png", alt: "avatar" %>
            </div>
          </div>
          <ul tabindex="0" class="menu menu-sm dropdown-content bg-white rounded-xl shadow-lg border border-gray-100 z-[1] mt-3 w-52 p-2">
            <% if admin_user? %>
              <li class="pb-2">
                <span class="inline-flex items-center gap-2 rounded-full bg-indigo-50 text-indigo-700 border border-indigo-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide">Admin</span>
              </li>
            <% end %>
            <% if current_user %>
              <li><%= link_to "Profile", user_path(current_user) %></li>
              <li><%= link_to "Order History", orders_path %></li>
              <li><%= link_to "Logout", logout_path, method: :delete %></li>
            <% else %>
              <li><%= link_to "Sign In", login_path %></li>
              <li><%= link_to "Sign Up", signup_path %></li>
            <% end %>
          </ul>
        </div>
      </div>
    </header>

    <main class="w-full max-w-screen-xl mx-auto px-6 sm:px-8 lg:px-12 py-8 flex-1">
      <% if flash[:notice] %>
        <div class="mb-4 rounded-xl bg-green-50 border border-green-100 px-4 py-3 text-green-700 shadow-sm"><%= flash[:notice] %></div>
      <% end %>
      <% if flash[:alert] %>
        <div class="mb-4 rounded-xl bg-amber-50 border border-amber-100 px-4 py-3 text-amber-700 shadow-sm"><%= flash[:alert] %></div>
      <% end %>
      <%= yield %>
    </main>

    <footer class="bg-gray-900 text-gray-200 mt-12">
      <div class="max-w-6xl mx-auto px-4 py-10 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
        <div>
          <h4 class="text-lg font-semibold mb-3">StoreApp</h4>
          <p class="text-sm text-gray-400 leading-relaxed">Modern bookstore experience built with Ruby on Rails.</p>
        </div>
      </div>
      <div class="border-t border-gray-800">
        <div class="max-w-6xl mx-auto px-4 py-4 text-sm text-gray-500 flex justify-between">
          <span>¬© <%= Time.current.year %> StoreApp. All rights reserved.</span>
          <span>Crafted with Rails & Tailwind.</span>
        </div>
      </div>
    </footer>
  </body>
</html>
